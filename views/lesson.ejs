<!doctype html>
<html lang="en">

<head>
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta name="description" content="">
   <title>
      <%= results?.title %>
   </title>
   <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
   <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:300,400,600,700">
   <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,600,700">
   <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@100;300;400;500;700;900&display=swap"
      rel="stylesheet">
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
   <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
      integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
   <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css">
   <link rel="stylesheet" href="https://s3.amazonaws.com/assets.chinesepod/css/lesson.css">
   <style>
      .plyr--full-ui.plyr--video .plyr__control--overlaid {
         background: none;
         /* color: #e31e1e; */
      }

      .plyr__control--overlaid svg {
         width: 40px;
         height: 40px;
      }

      .plyr--video .plyr__control:focus-visible,
      .plyr--video .plyr__control:hover,
      .plyr--video .plyr__control[aria-expanded=true] {
         background: #d21e1c;
      }

      .plyr--full-ui input[type=range] {
         color: #d01e1d;
      }
   </style>
</head>

<body class="cpLessionPage g-sidenav-show g-sidenav-pinned">
   <div class="wrapper">
      <!--sidebar menu starts here-->
      <div class="sidenav navbar navbar-vertical fixed-left navbar-expand-xs navbar-light bg-white" id="adminsidebar">
         <div class="sidenav-header d-flex align-items-center">
            <a href="/home" class="navbar-brand">
               <img src="https://s3.amazonaws.com/assets.chinesepod/images/logo.chinesepod.svg" style="height: 25px;"
                  alt="ChinesePod" class="navbar-brand-img">
            </a>
            <div class="ml-auto">
               <div class="sidenav-toggler">
                  <i class="far fa-bars"></i>
               </div>
            </div>
         </div>
         <div class="navbar-inner">
            <ul class="navbar-nav">
               <li class="nav-item">
                  <a href="/home" class="nav-link">
                     <i class="fas fa-home text-primary"></i>
                     <span class="nav-link-text">Home</span>
                  </a>
               </li>
               <li class="nav-item">
                  <a href="/courses" class="nav-link">
                     <i class="fal fa-compass"></i>
                     <span class="nav-link-text">Courses</span>
                  </a>
               </li>
               <li class="nav-item">
                  <a href="/playlists" class="nav-link">
                     <i class="fa fa-list text-primary"></i>
                     <span class="nav-link-text">Playlists</span>
                  </a>
               </li>
               <li class="nav-item">
                  <a href="/say-it-right" class="nav-link">
                     <i class="fas fa-language text-danger"></i>
                     <span class="nav-link-text">Say It Right</span>
                  </a>
               </li>
               <li class="nav-item">
                  <a href="/explore" class="nav-link">
                     <i class="fas fa-search text-info"></i>
                     <span class="nav-link-text">Explore</span>
                  </a>
               </li>
               <li class="nav-item">
                  <a href="/latest" class="nav-link">
                     <i class="fas fa-podcast text-warning"></i>
                     <span class="nav-link-text">Latest Lessons</span>
                  </a>
               </li>
               <li class="nav-item">
                  <a href="/bookmarks" class="nav-link">
                     <i class="fas fa-bookmark text-danger"></i>
                     <span class="nav-link-text">Bookmarks</span>
                  </a>
               </li>
               <li class="nav-item">
                  <a href="/history" class="nav-link">
                     <i class="fas fa-check-circle text-danger"></i>
                     <span class="nav-link-text">Lesson History</span>
                  </a>
               </li>
               <li class="nav-item">
                  <a href="/vocabulary" class="nav-link">
                     <i class="fal fa-clipboard-list text-primary"></i>
                     <span class="nav-link-text">Vocabulary</span>
                  </a>
               </li>
               <li class="nav-item">
                  <a href="/review/all" class="nav-link">
                     <i class="fas ni-lg fa-layer-group text-info"></i>
                     <span class="nav-link-text">Review Vocabulary</span>
                     <span class="badge ml-1 badge-danger">4 </span>
                  </a>
               </li>
               <li class="nav-item">
                  <a href="/dictionary" class="nav-link">
                     <i class="fas fa-books text-primary"></i>
                     <span class="nav-link-text">Dictionary</span>
                  </a>
               </li>
            </ul>
            <hr class="my-3">
            <h6 class="navbar-heading p-0 text-muted">Additional</h6>
            <ul class="navbar-nav mb-md-3">
               <li class="nav-item">
                  <a href="/levels" class="nav-link">
                     <i class="fas fa-chart-bar"></i>
                     <span class="nav-link-text">Levels</span>
                  </a>
               </li>
               <li class="nav-item">
                  <a href="https://forum.chinesepod.com" class="nav-link">
                     <i class="fas fa-thumbs-up"></i>
                     <span class="nav-link-text">Forum</span>
                  </a>
               </li>
               <li class="nav-item">
                  <a href="https://www.chinesepod.com/choice" class="nav-link">
                     <i class="fas fa-archive"></i>
                     <span class="nav-link-text">Old Dashboard</span>
                  </a>
               </li>
            </ul>
         </div>
      </div>
      <!--sidebar menu ends here-->
      <div class="main-content">
         <div class="container-fluid">
            <!--main menu starts here-->
            <nav class="navbar navbar-top border-bottom navbar-expand navbar-expand-lg bg-">
               <div class="container-fluid">
                  <button type="button" aria-expanded="false" aria-label="Toggle navigation"
                     class="navbar-toggler d-none collapsed"><span class="navbar-toggler-bar navbar-kebab"></span><span
                        class="navbar-toggler-bar navbar-kebab"></span><span
                        class="navbar-toggler-bar navbar-kebab"></span></button><button class="navbar-toggler"><span
                        class="navbar-toggler-icon"></span></button>
                  <div class="navbar-collapse navbar-custom-collapse collapse show" style="display: none;">
                     <ul class="navbar-nav align-items-center">
                        <li class="nav-item d-xl-none">
                           <div class="pr-3 sidenav-toggler sidenav-toggler-light">
                              <div class="sidenav-toggler-inner"><i class="sidenav-toggler-line"></i><i
                                    class="sidenav-toggler-line"></i><i class="sidenav-toggler-line"></i></div>
                           </div>
                        </li>
                        <form id="navbar-search-main" class="navbar-search form-inline mr-sm-3 navbar-search-dark">
                           <div class="form-group mb-0">
                              <div class="input-group input-group-alternative input-group-merge">
                                 <div class="input-group-prepend">
                                    <span class="input-group-text">
                                       <i class="fas fa-search"></i>
                                    </span>
                                 </div>
                                 <input placeholder="Search Lessons" type="text" class="form-control">
                                 <div class="d-none d-xl-flex input-group-append text-center" id="sprControls">
                                    <div class="bg-<%= data.level %> text-center p-0">
                                       <div class="custom-control custom-checkbox my-2">
                                          <input id="5206d211b2b29" type="checkbox" class="custom-control-input">
                                          <label for="5206d211b2b29" class="custom-control-label">
                                          </label>
                                       </div>
                                    </div>
                                    <div class="bg-elementary text-center p-0">
                                       <div class="custom-control custom-checkbox my-2">
                                          <input id="b68059d5ffc63" type="checkbox" class="custom-control-input">
                                          <label for="b68059d5ffc63" class="custom-control-label">
                                          </label>
                                       </div>
                                    </div>
                                    <div class="bg-preint text-center p-0">
                                       <div class="custom-control custom-checkbox my-2">
                                          <input id="d42fe26152379" type="checkbox" class="custom-control-input">
                                          <label for="d42fe26152379" class="custom-control-label">
                                          </label>
                                       </div>
                                    </div>
                                    <div class="bg-intermediate text-center p-0">
                                       <div class="custom-control custom-checkbox my-2">
                                          <input id="894ffbd7c0e2" type="checkbox" class="custom-control-input">
                                          <label for="894ffbd7c0e2" class="custom-control-label">
                                          </label>
                                       </div>
                                    </div>
                                    <div class="bg-upperint text-center p-0">
                                       <div class="custom-control custom-checkbox my-2">
                                          <input id="8c166ba2ecb9" type="checkbox" class="custom-control-input">
                                          <label for="8c166ba2ecb9" class="custom-control-label">
                                          </label>
                                       </div>
                                    </div>
                                    <div class="bg-advanced text-center p-0">
                                       <div class="custom-control custom-checkbox my-2">
                                          <input id="5dda4cb107bc9" type="checkbox" class="custom-control-input">
                                          <label for="5dda4cb107bc9" class="custom-control-label">
                                          </label>
                                       </div>
                                    </div>
                                    <button type="button" class="btn bg-transparent shadow-none px-2 text-white el-"
                                       tabindex="0">
                                       <i class="fas fa-chevron-down"></i>
                                    </button>
                                 </div>
                              </div>
                           </div>
                           <div class="el-popover el-popper search-popover popover-shadow sprPopper" id="sprPopper">
                              <div class="toolbar-text">
                                 <div class="d-flex flex-wrap">
                                    <div class="d-flex">
                                       <div class="row-1-box-1 pl-4"> Newbie </div>
                                       <div class="row-1-box-2"></div>
                                       <div class="row-1-box-3"></div>
                                       <div class="row-1-box-4"></div>
                                       <div class="row-1-box-5"></div>
                                       <div class="row-1-box-6 pr-4"> Advanced </div>
                                    </div>
                                    <div class="d-flex">
                                       <div class="row-2-box-1 pl-4"> Elementary </div>
                                       <div class="row-2-box-2"></div>
                                       <div class="row-2-box-3"></div>
                                       <div class="row-2-box-4 pr-4"> Upper-Intermediate </div>
                                    </div>
                                    <div class="d-flex">
                                       <div class="row-3-box-1 pl-4"> Pre-Intermediate </div>
                                       <div class="row-3-box-2 pr-4"> Intermediate </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </form>
                     </ul>
                     <div class="ml-auto">
                        <div class="dropdown">
                           <a href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"
                              class="nav-link pr-0">
                              <div class="d-flex align-items-center">
                                 <span class="avatar avatar-sm rounded-circle">
                                    <img alt="Image placeholder"
                                       src="https://www.chinesepod.com/dash/img/brand/symbol-black-center.svg"
                                       class="bg-white">
                                 </span>
                                 <div class="media-body ml-2">
                                    <span class="mb-0 text-sm font-weight-bold">nadir16</span>
                                 </div>
                              </div>
                           </a>
                           <ul class="dropdown-menu userMenu">
                              <div class="dropdown-header noti-title">
                                 <h6 class="text-overflow m-0">Welcome!</h6>
                              </div>
                              <a href="/profile" class="dropdown-item">
                                 <i class="fas fa-user"></i>
                                 <span>Profile</span>
                              </a>
                              <a href="/settings" class="dropdown-item">
                                 <i class="fas fa-cog"></i>
                                 <span>Settings</span>
                              </a>
                              <a href="https://support.chinesepod.com/" class="dropdown-item">
                                 <i class="fas fa-life-ring"></i>
                                 <span>Support</span>
                              </a>
                              <a href="/blog/the-chinesepod-tour/" class="dropdown-item">
                                 <i class="fas fa-compass"></i>
                                 <span>Tutorials</span>
                              </a>
                              <a href="/feedback" class="dropdown-item">
                                 <i class="fas fa-comments"></i>
                                 <span>Leave Feedback</span>
                              </a>
                              <a href="/contact" class="dropdown-item">
                                 <i class="fas fa-exclamation-triangle"></i>
                                 <span>Report Issue</span>
                              </a>
                              <div class="dropdown-divider"></div>
                              <a class="dropdown-item">
                                 <i class="far fa-running"></i>
                                 <span>Log out</span>
                              </a>
                           </ul>
                        </div>
                     </div>
                  </div>
               </div>
            </nav>
            <!--main menu ends here-->
            <div class="header-body">
               <div class="row align-items-center py-4">
                  <div class="col-9 col-sm-9 col-lg-8">
                     <a href="/home" class="d-inline-block d-md-none mr-2"><i class="fas fa-home"></i></a>
                     <a href="/courses/<%= data.course %>" class="d-inline-block d-md-none mx-2">Course Overview</a>
                     <h1 class="h2 d-inline-block mb-0 mr-md-4">
                        <%= results?.title %>
                     </h1>
                     <nav aria-label="breadcrumb" class="d-none d-md-inline-block">
                        <ol class="breadcrumb breadcrumb-links">
                           <li class="breadcrumb-item">
                              <a href="/" class="router-link-active">
                                 <i class="fas fa-home"></i>
                              </a>
                           </li>
                           <li class="breadcrumb-item">
                              <a href="/courses/<%= data.course %>" class="">Course Overview</a>
                           </li>
                           <li aria-current="page" class="breadcrumb-item active">
                              <%= results?.title %>
                           </li>
                        </ol>
                     </nav>
                  </div>
                  <div class="buttons col-3 col-sm-3 col-lg-4">
                     <div class="row">
                        <!--add and remove text-danger claass to these buttons to make active deactive-->
                        <div class="col-sm-6 mb-2">
                           <button id="btn_save_lesson" type="button" data-saved="false"
                              class="btn btn-icon btn-block btn-secondary" data-bs-toggle="tooltip"
                              data-bs-placement="top" data-bs-title="Some explanation about this button">
                              <!--<i class="m-0 fas fa-spinner fa-spin"></i>-->
                              <i class="m-0 far fa-bookmark"></i>
                              <span class="d-none d-lg-block"> Save</span>
                           </button>
                        </div>
                        <div class="col-sm-6">
                           <button id="btn_mark_complete" type="button" data-mark-complete="false"
                              class="btn btn-icon btn-block btn-secondary" data-bs-toggle="tooltip"
                              data-bs-placement="top" data-bs-title="Some explanation about this button">
                              <!--<i class="m-0 fas fa-spinner fa-spin"></i>-->
                              <i class="m-0 far fa-check-circle"></i>
                              <span class="d-none d-lg-block"> Complete</span>
                           </button>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="row justify-content-center">
                  <div class="col-sm-8">
                     <div class="col-xl-10 offset-xl-1">
                        <div class="row">
                           <div class="col-12">
                              <div class="row">
                                 <div class="col-12">
                                    <div class="row">
                                       <div class="col-12">
                                          <ul role="tablist" id="pills-tab-audio-video"
                                             class="col-12 nav nav-pills nav-pills-primary nav-fill flex-sm-row nav-wrapper p-0">
                                             <li role="presentation" class="col-6 col-md-6 nav-item px-2">
                                                <button class="btn btn-block btn-primary nav-link active"
                                                   data-bs-toggle="pill" data-bs-target="#pills-video-lesson"
                                                   type="button" role="tab" aria-controls="pills-video-lesson"
                                                   aria-selected="true">
                                                   <i class="fas fa-film"></i>
                                                   <span class="d-none d-md-block">Video Lesson</span>
                                                </button>
                                             </li>
                                             <li role="presentation" class="col-6 col-md-6 nav-item px-2">
                                                <button class="btn btn-block btn-secondary nav-link"
                                                   data-bs-toggle="pill" data-bs-target="#pills-audio-lesson"
                                                   type="button" role="tab" aria-controls="pills-audio-lesson"
                                                   aria-selected="false" tabindex="-1">
                                                   <i class="fas fa-podcast"></i>
                                                   <span class="d-none d-md-block">Audio Lesson</span>
                                                </button>
                                             </li>
                                          </ul>
                                          <div class="tab-content tab-space">
                                             <div class="tab-pane fade show active" id="pills-video-lesson"
                                                role="tabpanel" aria-labelledby="pills-video-lesson-tab">
                                                <div class="card-body p-2">
                                                   <div id="video_player_wrapper" style="position:relative;">
                                                      <!--add video player html here-->
                                                      <video id="videoplyr-s3" playsinline crossorigin
                                                         poster="<%= data.video.poster %>" style="width:100%">
                                                         <source src="<%= data.video.link %>"
                                                            type="application/vnd.apple.mpegURL">
                                                      </video>
                                                      <div
                                                         class="card-img-overlay align-items-center bg-translucent-dark d-none">
                                                         <div class="my-auto col-12">
                                                            <div class="row text-center">
                                                               <div class="col-12 col-xl-4 mb-2 mx-auto">
                                                                  <button type="button" id="btnRepeatVideo"
                                                                     class="btn btn-block btn-secondary"><i
                                                                        class="fas fa-redo"></i> Repeat Video</button>
                                                               </div>
                                                               <div class="col-12 col-xl-4 mb-2 mx-auto">
                                                                  <button type="button"
                                                                     class="btn btn-block btn-secondary"><i
                                                                        class="fal fa-clipboard-list"></i> Lesson
                                                                     Review</button>
                                                               </div>
                                                               <div class="col-12 col-xl-4 mb-2 mx-auto"
                                                                  style="display: none;">
                                                                  <button type="button"
                                                                     class="btn btn-block btn-secondary"><i
                                                                        class="fal fa-clipboard-list"></i> Lesson
                                                                     Review</button>
                                                               </div>
                                                            </div>
                                                         </div>
                                                      </div>
                                                   </div>
                                                </div>
                                             </div>
                                             <div class="tab-pane fade" id="pills-audio-lesson" role="tabpanel"
                                                aria-labelledby="pills-audio-lesson-tab">
                                                <div class="card-body p-0 mt-2">
                                                   <div class="col-12" style="">
                                                      <div class="card mb-0">
                                                         <img alt="Binge watching" class="card-img"
                                                            data-src="https://s3contents.chinesepod.com/4627/382bda1d90b77322a0caad3edb8de2085d23c6ae/images/1c4e3344a844bd7ace207db188dc4f16d013c770.png"
                                                            src="https://s3contents.chinesepod.com/4627/382bda1d90b77322a0caad3edb8de2085d23c6ae/images/1c4e3344a844bd7ace207db188dc4f16d013c770.png">
                                                         <audio crossorigin playsinline>
                                                            <source
                                                               src="https://cdn.plyr.io/static/demo/Kishi_Bashi_-_It_All_Began_With_a_Burst.mp3"
                                                               type="audio/mp3">
                                                         </audio>
                                                      </div>
                                                   </div>
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                    <div class="row">
                                       <div class="col-auto mt-2">
                                          <label class="custom-toggle">
                                             <input type="checkbox">
                                             <span data-label-off="No" data-label-on="Yes"
                                                class="custom-toggle-slider"></span>
                                          </label>
                                       </div>
                                       <div class="col small pt-1" style="display: flex; align-items: center;">
                                          <span>Automatically mark lessons as completed</span>
                                          <span class="ms-1">
                                             <i class="fa fa-info-circle el-" tabindex="0" data-bs-toggle="tooltip"
                                                data-bs-placement="top"
                                                data-bs-title="We'll mark lessons as completed once you cross the 95% mark. Don't worry, they'll always be available in your History area."></i>
                                          </span>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="row">
               <div class="card card-stats bg-gradient-secondary my-4 col-xl-10 offset-xl-1" show-footer-line="true">
                  <div class="card-body">
                     <div class="row">
                        <div class="col">
                           <div class="row">
                              <div class="col">
                                 <div class="row">
                                    <div class="col-4">
                                       <h5 class="card-title text-uppercase text-muted mb-0"> In this Lesson </h5>
                                    </div>
                                    <div class="col-8">
                                       <div class="ml-auto">
                                          <a href="/explore?search=&amp;<%= data.level %>=true" class="">
                                             <span class="badge float-right badge-default badge-lg <%= data.level %>">
                                                <%= data.level %>
                                             </span>
                                          </a>
                                          <span class="badge float-right me-2 badge-default badge-lg <%= data.level %>">ID:
                                             <%= data.id %>
                                          </span>
                                       </div>
                                    </div>
                                 </div>
                                 <div class="card-body mb-0">
                                    <span class="text-wrap">
                                       <%= data.lessonDetails %>
                                    </span>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="row">
               <div id="supplementary-materials-tab">
                  <div class="">
                     <ul role="tablist" id="pills-tab"
                        class="nav nav-pills nav-pills-primary nav-fill flex-sm-row nav-wrapper">
                        <% for(let key in data.supplementaryTabs) {%>
                           <li role="presentation" class="nav-item mt-2 mx-1">
                              <button class="nav-link <% if(key === "dialogue"){ %>active<%}%>" data-bs-toggle="pill"
                                    data-bs-target="#pills-<%= key %>" type="button" role="tab" aria-controls="pills-<%= key %>" aria-selected="true">
                                          <div>
                                             <span>
                                                <i class="far 
									                     <% if(key === "dialogue"){ %>
                                                   fa-comment-alt-dots
                                                   <%} else if(key === "vocabulary" ){%>
                                                      fa-clipboard-list
                                                      <%} else if(key === "expansion" ){%>
                                                         fa-external-link-alt
                                                         <%} else if(key === "downloads" ){%>
                                                            fa-cloud-download
                                                            <%} else if(key === "exercises" ){%>
                                                               fa-file-edit
                                                               <%} else if(key === "comments" ){%>
                                                                  fa-comment
                                                                  <%}%>
                                                                     ">
                                                </i>
                                                <span class="d-none d-md-block">
                                                   <%= key.charAt(0).toUpperCase() + key.slice(1); %>
                                                </span>
                                             </span>
                                          </div>
                              </button>
                           </li>
                           <%}%>
                     </ul>
                  </div>
                  <div id="pills-tabContent" class="tab-content tab-space card shadow">
                     <% for(let key in data.supplementaryTabs) {%>
                        <div class="tab-pane fade <% if(key === "dialogue"){ %>show active<%}%>" id="pills-<%= key %>"
                                 role="tabpanel"aria-labelledby="pills-<%= key %>-tab">
                                    <div class="card-body <%= key %>">
                                       <div>
                                          <% if (key !=="comments" ){ %>
                                             <div class="row">
                                                <div class="col-md-4">
                                                   <h2 class="h2">
                                                      <%= key %>
                                                   </h2>
                                                </div>
                                                <div class="col-md-8">
                                                   <button type="button" onclick="dialoguecreatePDF()"
                                                      class="btn d-block float-right btn-default btn-sm"><i
                                                         class="fas fa-print"></i> Print</button>
                                                   <button type="button"
                                                      class="btn float-right btn-default btn-sm me-1">Simp: 汉字</button>
                                                </div>
                                             </div>
                                             <% } %>
                                                <% if (key==="dialogue" ) { %>
                                                   <% for (var i=0; i < results.dialogues.length; i++) { %>
                                                      <div class="pt-2">
                                                         <div class="col-lg-8 offset-lg-2">
                                                            <div class="card card-pricing bg-lighter border-0 mb-4">
                                                               <div class="card-header bg-transparent">
                                                                  <div class="row align-items-center">
                                                                     <div class="col-10 col-sm-11">
                                                                        <% var item = results.dialogues[i].sentence; %>
                                                                        <p class=" characters">
                                                                           <% for (var j=0; j < item.length; j++) { %>
                                                                              <span
                                                                                 onclick="tip(this,'<%= item[j].english %>','<%= item[j].pinyin%>','<%= item[j].traditional %>')"
                                                                                 class="transcript align-middle"
                                                                                 tabindex="0">
                                                                                 <%= item[j].traditional%>
                                                                              </span>
                                                                           <% } %>
                                                                        </p>
                                                                     </div>
                                                                     <div class="col-2 col-sm-1 text-right">
                                                                        <button type="button"
                                                                           onclick="toggleTranslatePlay(this)"
                                                                           play-info="0000<%= i+1 %>0"
                                                                           class="btn float-right btn-icon-only m-0 mb-1 btn-secondary"><i
                                                                              class="fas fa-volume-up"></i></button>
                                                                        <button type="button"
                                                                           onclick="addToVocabulary(this, '你好。')"
                                                                           vocab-added="false"
                                                                           class="btn float-right btn-icon-only btn-secondary"><i
                                                                              class="fas fa-plus"></i></button>
                                                                     </div>
                                                                     <div id="play_wrapper_0000<%= i+1 %>0"
                                                                        class="col-12 pt-1 d-none">
                                                                        <audio class="js-player" crossorigin
                                                                           playsinline>
                                                                           <source
                                                                              src="<%= results.dialogues[i].audio %>"
                                                                              type="audio/mp3">
                                                                        </audio>
                                                                     </div>
                                                                  </div>
                                                               </div>
                                                               <div class="card-body">
                                                                  <div class="row align-items-center">
                                                                     <div class="col-10 col-sm-11">
                                                                        <p class="pinyin" id="voc_<%= i+1 %>_0"
                                                                           style="display: none;">
                                                                           <span
                                                                              class="transcript align-middle el- pinyin">
                                                                              <%= results.dialogues[i].pinyin%>
                                                                           </span>
                                                                           <span class="pinyin">。</span>
                                                                        </p>
                                                                     </div>
                                                                     <div class="col-2 col-sm-1">
                                                                        <button type="button" id="btn_voc_<%= i+1 %>_0"
                                                                           onclick="toggleDisplayAssistance('voc_<%= i+1 %>_0', 'btn_voc_<%= i+1 %>_0')"
                                                                           class="btn float-right btn-icon-only btn-secondary"><i
                                                                              class="fas fa-eye"></i></button>
                                                                     </div>
                                                                  </div>
                                                               </div>
                                                               <div class="card-footer bg-transparent">
                                                                  <div class="row align-items-center">
                                                                     <div class="col-10 col-sm-11">
                                                                        <p class="english" id="voc_<%= i+1 %>_1"
                                                                           style="display: none;">
                                                                           <%= results.dialogues[i].english %>
                                                                        </p>
                                                                     </div>
                                                                     <div class="col-2 col-sm-1">
                                                                        <button type="button" id="btn_voc_<%= i+1 %>_1"
                                                                           onclick="toggleDisplayAssistance('voc_<%= i+1 %>_1', 'btn_voc_<%= i+1 %>_1')"
                                                                           class="btn float-right btn-icon-only btn-secondary"><i
                                                                              class="fas fa-eye"></i></button>
                                                                     </div>
                                                                  </div>
                                                               </div>
                                                            </div>
                                                         </div>
                                                      </div>

                                                      <% } %>
                                                         <% } else if (key==="vocabulary" ) { %>
                                                            <div class="pt-2">
                                                               <div class="d-none" id="vocab_aduio_player">
                                                                  <audio controls id="vocabplyrlist">
                                                                     <source src="" type="audio/mp3">
                                                                  </audio>
                                                               </div>
                                                               <table class="table tablesorter col-12">
                                                                  <thead class="">
                                                                     <tr>
                                                                        <th scope="col"
                                                                           class="text-center bg-transparent px-2">
                                                                           traditional
                                                                           <i class="fa fa-info-circle el-" tabindex="0"
                                                                              data-bs-toggle="tooltip"
                                                                              data-bs-placement="top"
                                                                              data-bs-title="Click a phrase to start the animation"></i>
                                                                        </th>
                                                                        <th scope="col"
                                                                           class="text-center bg-transparent px-2">
                                                                           Pinyin</th>
                                                                        <th scope="col"
                                                                           class="text-center bg-transparent px-2">
                                                                           English
                                                                        </th>
                                                                        <th scope="col"
                                                                           class="text-right bg-transparent px-2">
                                                                           <div class="select-deck-dropdown ml-auto">
                                                                              <div class="dropdown">
                                                                                 <button type="button"
                                                                                    class="btn btn-icon btn-fab btn-secondary"
                                                                                    data-bs-toggle="dropdown"
                                                                                    aria-expanded="false">
                                                                                    <i class="fas fa-plus"></i>
                                                                                    <span class="">Save all</span>
                                                                                    <span class="d-none">All</span>
                                                                                 </button>
                                                                                 <ul
                                                                                    class="dropdown-menu dropdown-menu-right">
                                                                                    <div class="dropdown-header">
                                                                                       <h6 class="text-overflow m-0">To
                                                                                          existing decks:</h6>
                                                                                    </div>
                                                                                    <div class="dropdown-divider"></div>
                                                                                    <div class="dropdown-item">
                                                                                       <i class="fas fa-plus"></i>
                                                                                       <span>Create Deck</span>
                                                                                    </div>
                                                                                 </ul>
                                                                              </div>
                                                                           </div>
                                                                        </th>
                                                                     </tr>
                                                                  </thead>
                                                                  <tbody class="">
                                                                     <% for (var i=0; i < results.vocabularies.length;
                                                                        i++) { %>
                                                                        <tr>
                                                                           <td
                                                                              class="text-center align-middle vocabulary px-1 px-lg-5">
                                                                              <div
                                                                                 aria-label="<%= results.vocabularies[i].traditional %>">
                                                                                 <% for (var j=0; j < 
                                                                                 results.vocabularies[i].traditional.length;
                                                                                    j++) { %>
                                                                                    <span id="<%= i %>-<%= j %>-<%= results.vocabularies[i].traditional[j] %>" class="cp-char characters"></span>
                                                                                    <% } %>
                                                                              </div>
                                                                           </td>
                                                                           <td
                                                                              class="text-center align-middle vocabulary px-1 px-lg-5 pinyin">
                                                                              <%= results.vocabularies[i].pinyin %>
                                                                           </td>
                                                                           <td
                                                                              class="text-center align-middle vocabulary px-1 px-lg-5 english">
                                                                              <%= results.vocabularies[i].english %>
                                                                           </td>
                                                                           <td class="px-0 align-middle">
                                                                              <div
                                                                                 class="row justify-content-end pr-md-3 pr-lg-4">
                                                                                 <div
                                                                                    class="col-12 col-md-3 col-auto mb-1">
                                                                                    <button type="button"
                                                                                       data-type="mp3"
                                                                                       data-src="<%= results.vocabularies[i].audio %>"
                                                                                       class="btn btn-icon-only ml-1 btn-secondary btn-sm player-src">
                                                                                       <i class="fas fa-volume-up"></i>
                                                                                    </button>
                                                                                 </div>
                                                                                 <div
                                                                                    class="col-12  col-md-3 col-auto mb-1">
                                                                                    <button type="button"
                                                                                       onclick="copyVocabOnCB('<%= results.vocabularies[i].traditional %>','lǎoniánchīdāizhèng','senile dementia')"
                                                                                       class="btn btn-icon-only ml-1 btn-secondary btn-sm">
                                                                                       <i class="far fa-copy"></i>
                                                                                    </button>
                                                                                 </div>
                                                                                 <div
                                                                                    class="col-12  col-md-3 col-auto mb-1">
                                                                                    <button type="button"
                                                                                       onclick="addToVocabulary(this, '<%= results.vocabularies[i].traditional %>')"
                                                                                       vocab-added="false"
                                                                                       class="btn btn-icon-only ml-1 btn-icon btn-fab btn-secondary btn-sm">
                                                                                       <i class="fa fa-plus"></i>
                                                                                    </button>
                                                                                 </div>
                                                                              </div>
                                                                           </td>
                                                                        </tr>
                                                                        <% } %>
                                                                  </tbody>
                                                               </table>
                                                            </div>
                                                            <% } else if (key==="expansion" ) { %>
                                                               <% for (var i=0; i < results.expansions.length; i++) { %>
                                                                  <div class="pt-2">
                                                                     <div class="offset-lg-2 col-lg-8 pb-4">
                                                                        <h3 class="h3 example ml-2">
                                                                           <%= results.expansions[i].phrase %>
                                                                        </h3>
                                                                        <% for (var k=0; k < results.expansions[i].examples.length; k++) { %>
                                                                           <div class="card card-pricing bg-lighter border-0 mb-4">
                                                                              <div class="card-header bg-transparent">
                                                                                 <div class="row align-items-center">
                                                                                    <div class="col-10 col-sm-11">
                                                                                       <% var item = results.expansions[i].examples[k].sentence; %>
                                                                                       <p class=" characters">
                                                                                          <% for (var j=0; j < item.length; j++) { %>
                                                                                             <span
                                                                                                onclick="tip(this,'<%= item[j].english %>','<%= item[j].pinyin%>','<%= item[j].traditional %>')"
                                                                                                class="transcript align-middle"
                                                                                                tabindex="0">
                                                                                                <%= item[j].traditional%>
                                                                                             </span>
                                                                                          <% } %>
                                                                                       </p>
                                                                                    </div>
                                                                                    <div class="col-2 col-sm-1 text-right">
                                                                                       <button type="button"
                                                                                          onclick="toggleTranslatePlay(this)"
                                                                                          play-info="0000<%= k %>3"
                                                                                          class="btn float-right btn-icon-only m-0 mb-1 btn-secondary"><i
                                                                                             class="fas fa-volume-up"></i></button>
                                                                                       <button type="button"
                                                                                          onclick="addToVocabulary(this, '離鄉多年了，但家鄉的風景依然歷歷在目。')"
                                                                                          vocab-added="false"
                                                                                          class="btn float-right btn-icon-only btn-secondary"><i
                                                                                             class="fas fa-plus"></i></button>
                                                                                    </div>
                                                                                    <div id="play_wrapper_0000<%= k %>3"
                                                                                       class="col-12 pt-1 d-none">
                                                                                       <audio class="js-player" crossorigin
                                                                                          playsinline>
                                                                                          <source src="<%= results.expansions[i].examples[k].audio %>" type="audio/mp3">
                                                                                       </audio>
                                                                                    </div>
                                                                                 </div>
                                                                              </div>
                                                                              <div class="card-body">
                                                                                 <div class="row align-items-center">
                                                                                    <div class="col-10 col-sm-11">
                                                                                       <p class="pinyin" id="exp_<%= k %>_1"
                                                                                          style="display: none;">
                                                                                          <span
                                                                                             class="transcript align-middle el-"
                                                                                             tabindex="0">
                                                                                             <%= results.expansions[i].examples[k].pinyin %>
                                                                                          </span>
                                                                                       </p>
                                                                                    </div>
                                                                                    <div class="col-2 col-sm-1">
                                                                                       <button type="button"
                                                                                          id="btn_exp_<%= k %>_1"
                                                                                          onclick="toggleDisplayAssistance('exp_<%= k %>_1', 'btn_exp_<%= k %>_1')"
                                                                                          class="btn float-right btn-icon-only btn-secondary"><i
                                                                                             class="fas fa-eye"></i></button>
                                                                                    </div>
                                                                                 </div>
                                                                              </div>
                                                                              <div class="card-footer bg-transparent">
                                                                                 <div class="row align-items-center">
                                                                                    <div class="col-10 col-sm-11">
                                                                                       <p class="english" id="exp_<%= k %>_0"
                                                                                          style="display: none;">
                                                                                          <%= results.expansions[i].examples[k].english %>
                                                                                       </p>
                                                                                    </div>
                                                                                    <div class="col-2 col-sm-1">
                                                                                       <button type="button"
                                                                                          id="btn_exp_<%= k %>_0"
                                                                                          onclick="toggleDisplayAssistance('exp_<%= k %>_0', 'btn_exp_<%= k %>_0')"
                                                                                          class="btn float-right btn-icon-only btn-secondary"><i
                                                                                             class="fas fa-eye"></i></button>
                                                                                    </div>
                                                                                 </div>
                                                                              </div>
                                                                           </div>
                                                                        <% } %>
                                                                     </div>
                                                                  </div>
                                                                  <% } %>
                                                                     <% } else if (key==="downloads" ) { %>
                                                                        <div>
                                                                           <div class="row is-justify-space-between">
                                                                              <div class="col-sm-6 col-xl-3">
                                                                                 <div
                                                                                    class="card border-0 text-center bg-gray">
                                                                                    <div class="card-body">
                                                                                       <div class="row">
                                                                                          <div class="col-8 text-start">
                                                                                             <h4
                                                                                                class="text-uppercase ls-1 text-white py-3 mb-0">
                                                                                                Thumbnail</h4>
                                                                                          </div>
                                                                                          <div class="col-4 my-auto">
                                                                                             <button type="button"
                                                                                                class="btn btn-light btn-sm">
                                                                                                <i
                                                                                                   class="ni-lg py-2 fas fa-download"></i>
                                                                                             </button>
                                                                                          </div>
                                                                                       </div>
                                                                                    </div>
                                                                                 </div>
                                                                              </div>
                                                                              <div class="col-sm-6 col-xl-3">
                                                                                 <div
                                                                                    class="card border-0 text-center bg-gray">
                                                                                    <div class="card-body">
                                                                                       <div class="row">
                                                                                          <div class="col-8 text-start">
                                                                                             <h4
                                                                                                class="text-uppercase ls-1 text-white py-3 mb-0">
                                                                                                Video Lesson</h4>
                                                                                          </div>
                                                                                          <div class="col-4 my-auto">
                                                                                             <button type="button"
                                                                                                class="btn btn-light btn-sm">
                                                                                                <i
                                                                                                   class="ni-lg py-2 fas fa-download"></i>
                                                                                             </button>
                                                                                          </div>
                                                                                       </div>
                                                                                    </div>
                                                                                 </div>
                                                                              </div>
                                                                              <div class="col-sm-6 col-xl-3">
                                                                                 <div
                                                                                    class="card border-0 text-center bg-gray">
                                                                                    <div class="card-body">
                                                                                       <div class="row">
                                                                                          <div class="col-8 text-start">
                                                                                             <h4
                                                                                                class="text-uppercase ls-1 text-white py-3 mb-0">
                                                                                                Audio Lesson</h4>
                                                                                          </div>
                                                                                          <div class="col-4 my-auto">
                                                                                             <button type="button"
                                                                                                class="btn btn-light btn-sm">
                                                                                                <i
                                                                                                   class="ni-lg py-2 fas fa-download"></i>
                                                                                             </button>
                                                                                          </div>
                                                                                       </div>
                                                                                    </div>
                                                                                 </div>
                                                                              </div>
                                                                           </div>
                                                                        </div>
                                                                        <% } else if (key==="exercises" ) { %>
                                                                           <div id="exercises"
                                                                              class="col-12 col-lg-8 offset-lg-2">
                                                                              <div
                                                                                 style="transform-origin: center top;">
                                                                                 <div
                                                                                    class="card card-stats bg-gradient-warning">
                                                                                    <div class="card-body">
                                                                                       <div class="row">
                                                                                          <div class="col">
                                                                                             <div class="row">
                                                                                                <div class="col">
                                                                                                   <h5
                                                                                                      class="card-title text-uppercase mb-0 text-white">
                                                                                                      Previous Results
                                                                                                   </h5>
                                                                                                   <span
                                                                                                      class="h2 font-weight-bold mb-0 text-white">Taken:
                                                                                                      3 times</span>
                                                                                                </div>
                                                                                                <div class="col-auto">
                                                                                                   <div
                                                                                                      class="icon icon-shape bg-white text-dark rounded-circle shadow">
                                                                                                      <i
                                                                                                         class="fa fa-star"></i>
                                                                                                   </div>
                                                                                                </div>
                                                                                             </div>
                                                                                             <p
                                                                                                class="h3 mt-3 mb-0 text-sm">
                                                                                                <span
                                                                                                   class="text-nowrap text-white">Last
                                                                                                   score: </span>
                                                                                                <span
                                                                                                   class="text-white mr-2">6
                                                                                                   / 19</span>
                                                                                             </p>
                                                                                             <p class="mb-0 text-sm">
                                                                                                <span
                                                                                                   class="text-white">Aim
                                                                                                   for at least 70%. Try
                                                                                                   again!</span>
                                                                                             </p>
                                                                                          </div>
                                                                                       </div>
                                                                                    </div>
                                                                                 </div>
                                                                              </div>
                                                                              <div class="exercise-view">
                                                                                 <div class="exercise-container">
                                                                                    <% for (let elem in results.questions) { %>
                                                                                       <% if (elem === "choice") { %>
                                                                                          <% for (let i=0; i < results.questions[elem].length; i++) { %>
                                                                                             <div
                                                                                                class="exercise-block <% if(i > 0) { %>d-none<% } %>"
                                                                                                exercise_active="<% if(i > 0) { %>false<% } else { %>true<% } %>"
                                                                                                id="exercise_00<%= i+1 %>">
                                                                                                <div class="col-12">
                                                                                                   <header>
                                                                                                      <h1 class="title">
                                                                                                         Choose
                                                                                                         the right option
                                                                                                      </h1>
                                                                                                      <div class="scores">
                                                                                                         <div
                                                                                                            class="score-block">
                                                                                                            <span
                                                                                                               class="score">1</span><span
                                                                                                               class="points">
                                                                                                               point
                                                                                                            </span>
                                                                                                         </div>
                                                                                                      </div>
                                                                                                   </header>
                                                                                                </div>
                                                                                                <div
                                                                                                   class="sentence-to-fill">
                                                                                                   <div class="chinese">
                                                                                                      <%= results.questions[elem][i].question.traditional
                                                                                                         %>
                                                                                                   </div>
                                                                                                   <div class="pinyin">
                                                                                                      <%= results.questions[elem][i].question.pinyin
                                                                                                         %>
                                                                                                   </div>
                                                                                                </div>
                                                                                                <div class="answers">
                                                                                                   <% for (var j=0; j < results.questions[elem][i].question.choices.length; j++) { %>
                                                                                                      <div class="col-12 col-sm-6">
                                                                                                         <button
                                                                                                            type="button"
                                                                                                            class="btn btn-light btn-block mb-2"
                                                                                                            onclick="mcqCheck('<%= results.questions[elem][i].question.choices[j].id %>', '<%= results.questions[elem][i].answer.id %>')"
                                                                                                         >
                                                                                                            <div
                                                                                                               class="row">
                                                                                                               <div class="col-12 characters">
                                                                                                                  <%= results.questions[elem][i].question.choices[j].traditional %>
                                                                                                               </div>
                                                                                                               <div
                                                                                                                  class="col-12 pinyin text-white">
                                                                                                                  <%= results.questions[elem][i].question.choices[j].pinyin %>
                                                                                                               </div>
                                                                                                            </div>
                                                                                                         </button>
                                                                                                      </div>
                                                                                                      <% } %>
                                                                                                         <script>
                                                                                                            var marks = 0;
                                                                                                            function mcqCheck(val, correct) {
                                                                                                               if (val == correct) {
                                                                                                                  marks++
                                                                                                               }
                                                                                                               console.log(marks)
                                                                                                               callNextExercise()
                                                                                                            }
                                                                                                            
                                                                                                         </script>
                                                                                                </div>
                                                                                             </div>
                                                                                          <% } %>
                                                                                          <% } else if (key === "matching") { %>
                                                                                             <div
                                                                                                class="exercise-block d-none"
                                                                                                exercise_active="flase"
                                                                                                id="exercise_00<%= i+1 %>">
                                                                                                <div class="col-12">
                                                                                                   <header>
                                                                                                      <h1 class="title">
                                                                                                         Match the
                                                                                                         phrase with the
                                                                                                         translation
                                                                                                      </h1>
                                                                                                      <div
                                                                                                         class="scores">
                                                                                                         <div
                                                                                                            class="score-block">
                                                                                                            <span
                                                                                                               class="score">5</span><span
                                                                                                               class="points">
                                                                                                               points</span>
                                                                                                         </div>
                                                                                                      </div>
                                                                                                   </header>
                                                                                                </div>
                                                                                                <div id="parts-120357"
                                                                                                   class="parts">
                                                                                                   <div
                                                                                                      class="parts-left col-6">
                                                                                                      <% results.questions[elem].question.segments.forEach((elem, index)=> { %>
                                                                                                         <button
                                                                                                            type="button"
                                                                                                            class="btn btn-light btn-block mb-2"
                                                                                                            data-tag="<%= elem.id %>">
                                                                                                            <div
                                                                                                               class="row">
                                                                                                               <div
                                                                                                                  class="col-12 characters">
                                                                                                                  <%= elem.traditional %>
                                                                                                               </div>
                                                                                                               <div
                                                                                                                  class="col-12 pinyin text-white">
                                                                                                                  <%= elem.pinyin %>
                                                                                                               </div>
                                                                                                            </div>
                                                                                                         </button>
                                                                                                         <% }) %>
                                                                                                   </div>
                                                                                                   <div
                                                                                                      class="parts-right col-6">
                                                                                                      <% results.questions[elem].question.segments.forEach((elem,
                                                                                                         index)=> { %>
                                                                                                         <button
                                                                                                            type="button"
                                                                                                            class="btn btn-light btn-block mb-2"
                                                                                                            data-tag="<%= elem.id %>">
                                                                                                            <div
                                                                                                               class="row">
                                                                                                               <div
                                                                                                                  class="col-12 english text-white">
                                                                                                                  <%= elem.english %>
                                                                                                               </div>
                                                                                                            </div>
                                                                                                         </button>
                                                                                                         <% }) %>
                                                                                                   </div>
                                                                                                </div>
                                                                                             </div>
                                                                                             <% } else if
                                                                                                (data.supplementaryTabs[key][i].type===3)
                                                                                                { %>
                                                                                                <div
                                                                                                   class="exercise-block d-none"
                                                                                                   exercise_active="flase"
                                                                                                   id="exercise_00<%= i+1 %>">
                                                                                                   <div class="col-12">
                                                                                                      <header>
                                                                                                         <h1
                                                                                                            class="title">
                                                                                                            Re-order the
                                                                                                            segments
                                                                                                         </h1>
                                                                                                         <div
                                                                                                            class="scores">
                                                                                                            <div
                                                                                                               class="score-block">
                                                                                                               <span
                                                                                                                  class="score">6</span><span
                                                                                                                  class="points">
                                                                                                                  points</span>
                                                                                                            </div>
                                                                                                         </div>
                                                                                                      </header>
                                                                                                   </div>
                                                                                                   <div
                                                                                                      class="draggable-sentences">
                                                                                                      <% data.supplementaryTabs[key][i].answers.forEach((elem,
                                                                                                         index)=> { %>
                                                                                                         <div
                                                                                                            class="card bg-gradient-lighter">
                                                                                                            <div
                                                                                                               class="card-body row">
                                                                                                               <div
                                                                                                                  class="col-10 col-sm-11">
                                                                                                                  <span
                                                                                                                     class="characters">當你看著屏幕中一個個腥羴色，暴力的鏡頭，這些啊，其實都會進入你的潛意識。</span>
                                                                                                                  <footer
                                                                                                                     class="pinyin">
                                                                                                                     dāng
                                                                                                                     nǐ
                                                                                                                     kàn
                                                                                                                     zhe
                                                                                                                     píngmù
                                                                                                                     zhōng
                                                                                                                     yīgègè
                                                                                                                     xīng
                                                                                                                     shān
                                                                                                                     sè,bàolì
                                                                                                                     de
                                                                                                                     jìngtóu,zhèxiē
                                                                                                                     a,qíshí
                                                                                                                     dōu
                                                                                                                     huì
                                                                                                                     jìnrù
                                                                                                                     nǐ
                                                                                                                     de
                                                                                                                     qiányìshí.
                                                                                                                  </footer>
                                                                                                               </div>
                                                                                                               <div
                                                                                                                  class="col-2 col-sm-1">
                                                                                                                  <div
                                                                                                                     class="row">
                                                                                                                     <div
                                                                                                                        class="col-12">
                                                                                                                        <button
                                                                                                                           type="button"
                                                                                                                           class="btn btn-icon-only mb-2 btn-secondary btn-lg"
                                                                                                                           style="display: none;">
                                                                                                                           <i
                                                                                                                              class="text-lg fa fa-chevron-up"></i>
                                                                                                                        </button>
                                                                                                                     </div>
                                                                                                                  </div>
                                                                                                               </div>
                                                                                                            </div>
                                                                                                         </div>
                                                                                                         <% }) %>
                                                                                                   </div>
                                                                                                </div>
                                                                                                <% } else if
                                                                                                   (data.supplementaryTabs[key][i].type===4)
                                                                                                   { %>
                                                                                                   <div
                                                                                                      class="exercise-block d-none"
                                                                                                      exercise_active="flase"
                                                                                                      id="exercise_00<%= i+1 %>">
                                                                                                      <div
                                                                                                         class="col-12">
                                                                                                         <header>
                                                                                                            <h1
                                                                                                               class="title">
                                                                                                               Listen
                                                                                                               and type
                                                                                                            </h1>
                                                                                                            <div
                                                                                                               class="scores">
                                                                                                               <div
                                                                                                                  class="score-block">
                                                                                                                  <span
                                                                                                                     class="score">1</span><span
                                                                                                                     class="points">
                                                                                                                     point</span>
                                                                                                               </div>
                                                                                                            </div>
                                                                                                            <div
                                                                                                               class="exercise-number">
                                                                                                               Exercise
                                                                                                               1.</div>
                                                                                                         </header>
                                                                                                      </div>
                                                                                                      <div
                                                                                                         class="sentence col-12 mb-3">
                                                                                                         <div
                                                                                                            class="form-group w-100">
                                                                                                            <div
                                                                                                               class="input-group">
                                                                                                               <div
                                                                                                                  id="button-addon1"
                                                                                                                  class="input-group-prepend">
                                                                                                                  <button
                                                                                                                     type="button"
                                                                                                                     class="btn btn-outline-primary"><i
                                                                                                                        class="fa ni-lg fa fa-play"></i></button>
                                                                                                                  <audio
                                                                                                                     src="https://cdn.plyr.io/static/demo/Kishi_Bashi_-_It_All_Began_With_a_Burst.mp3"></audio>
                                                                                                               </div>
                                                                                                               <input
                                                                                                                  type="text"
                                                                                                                  placeholder="Type-in what you hear..."
                                                                                                                  autofocus="autofocus"
                                                                                                                  aria-label="Listening Practice Input"
                                                                                                                  aria-describedby="button-addon1"
                                                                                                                  class="form-control"><small
                                                                                                                  class="font-italic"></small>
                                                                                                            </div>
                                                                                                            <div
                                                                                                               class="valid-feedback">
                                                                                                            </div>
                                                                                                         </div>
                                                                                                      </div>
                                                                                                      <p
                                                                                                         class="exercise-description exercise-description--small">
                                                                                                         To type in
                                                                                                         Chinese, you'll
                                                                                                         need to first
                                                                                                         install a
                                                                                                         Chinese
                                                                                                         keyboard on
                                                                                                         your phone or
                                                                                                         computer. To
                                                                                                         write in
                                                                                                         Pinyin, you can
                                                                                                         use an English
                                                                                                         keyboard and
                                                                                                         use numbers for
                                                                                                         tones. e.g.
                                                                                                         ni3hao3</p>
                                                                                                   </div>
                                                                                                   <% } %>
                                                                                                      <% } %>
                                                                                                         <div
                                                                                                            class="exercise-block d-none"
                                                                                                            exercise_active="flase"
                                                                                                            id="exercise_003">
                                                                                                            <div
                                                                                                               class="col-12">
                                                                                                               <header>
                                                                                                                  <h1
                                                                                                                     class="title">
                                                                                                                     Match
                                                                                                                     the
                                                                                                                     phrase
                                                                                                                     with
                                                                                                                     the
                                                                                                                     translation
                                                                                                                  </h1>
                                                                                                                  <div
                                                                                                                     class="scores">
                                                                                                                     <div
                                                                                                                        class="score-block">
                                                                                                                        <span
                                                                                                                           class="score">5</span><span
                                                                                                                           class="points">
                                                                                                                           points</span>
                                                                                                                     </div>
                                                                                                                  </div>
                                                                                                               </header>
                                                                                                            </div>
                                                                                                            <div
                                                                                                               id="parts-120357"
                                                                                                               class="parts">
                                                                                                               <div
                                                                                                                  class="parts-left col-6">
                                                                                                                  <button
                                                                                                                     type="button"
                                                                                                                     class="btn btn-light btn-block mb-2"
                                                                                                                     data-tag="3">
                                                                                                                     <div
                                                                                                                        class="row">
                                                                                                                        <div
                                                                                                                           class="col-12 characters">
                                                                                                                           潛意識
                                                                                                                        </div>
                                                                                                                        <div
                                                                                                                           class="col-12 pinyin text-white">
                                                                                                                           qiányìshí
                                                                                                                        </div>
                                                                                                                     </div>
                                                                                                                  </button>
                                                                                                                  <button
                                                                                                                     type="button"
                                                                                                                     class="btn btn-light btn-block mb-2"
                                                                                                                     data-tag="2">
                                                                                                                     <div
                                                                                                                        class="row">
                                                                                                                        <div
                                                                                                                           class="col-12 characters">
                                                                                                                           刷劇
                                                                                                                        </div>
                                                                                                                        <div
                                                                                                                           class="col-12 pinyin text-white">
                                                                                                                           shuājù
                                                                                                                        </div>
                                                                                                                     </div>
                                                                                                                  </button>
                                                                                                                  <button
                                                                                                                     type="button"
                                                                                                                     class="btn btn-light btn-block mb-2"
                                                                                                                     data-tag="5">
                                                                                                                     <div
                                                                                                                        class="row">
                                                                                                                        <div
                                                                                                                           class="col-12 characters">
                                                                                                                           放縱
                                                                                                                        </div>
                                                                                                                        <div
                                                                                                                           class="col-12 pinyin text-white">
                                                                                                                           fàngzòng
                                                                                                                        </div>
                                                                                                                     </div>
                                                                                                                  </button>
                                                                                                                  <button
                                                                                                                     type="button"
                                                                                                                     class="btn btn-light btn-block mb-2"
                                                                                                                     data-tag="1">
                                                                                                                     <div
                                                                                                                        class="row">
                                                                                                                        <div
                                                                                                                           class="col-12 characters">
                                                                                                                           歷歷在目
                                                                                                                        </div>
                                                                                                                        <div
                                                                                                                           class="col-12 pinyin text-white">
                                                                                                                           lìlìzàimù
                                                                                                                        </div>
                                                                                                                     </div>
                                                                                                                  </button>
                                                                                                                  <button
                                                                                                                     type="button"
                                                                                                                     class="btn btn-light btn-block mb-2"
                                                                                                                     data-tag="4">
                                                                                                                     <div
                                                                                                                        class="row">
                                                                                                                        <div
                                                                                                                           class="col-12 characters">
                                                                                                                           輾轉反側
                                                                                                                        </div>
                                                                                                                        <div
                                                                                                                           class="col-12 pinyin text-white">
                                                                                                                           zhǎnzhuǎnfǎncè
                                                                                                                        </div>
                                                                                                                     </div>
                                                                                                                  </button>
                                                                                                               </div>
                                                                                                               <div
                                                                                                                  class="parts-right col-6">
                                                                                                                  <button
                                                                                                                     type="button"
                                                                                                                     class="btn btn-light btn-block mb-2"
                                                                                                                     data-tag="2">
                                                                                                                     <div
                                                                                                                        class="row">
                                                                                                                        <div
                                                                                                                           class="col-12 english text-white">
                                                                                                                           binge
                                                                                                                           watching
                                                                                                                        </div>
                                                                                                                     </div>
                                                                                                                  </button>
                                                                                                                  <button
                                                                                                                     type="button"
                                                                                                                     class="btn btn-light btn-block mb-2"
                                                                                                                     data-tag="5">
                                                                                                                     <div
                                                                                                                        class="row">
                                                                                                                        <div
                                                                                                                           class="col-12 english text-white">
                                                                                                                           to
                                                                                                                           indulge;
                                                                                                                           to
                                                                                                                           pamper;
                                                                                                                           to
                                                                                                                           connive
                                                                                                                           at
                                                                                                                        </div>
                                                                                                                     </div>
                                                                                                                  </button>
                                                                                                                  <button
                                                                                                                     type="button"
                                                                                                                     class="btn btn-light btn-block mb-2"
                                                                                                                     data-tag="4">
                                                                                                                     <div
                                                                                                                        class="row">
                                                                                                                        <div
                                                                                                                           class="col-12 english text-white">
                                                                                                                           to
                                                                                                                           toss
                                                                                                                           and
                                                                                                                           turn
                                                                                                                           restlessly
                                                                                                                           (in
                                                                                                                           the
                                                                                                                           bed)
                                                                                                                        </div>
                                                                                                                     </div>
                                                                                                                  </button>
                                                                                                                  <button
                                                                                                                     type="button"
                                                                                                                     class="btn btn-light btn-block mb-2"
                                                                                                                     data-tag="1">
                                                                                                                     <div
                                                                                                                        class="row">
                                                                                                                        <div
                                                                                                                           class="col-12 english text-white">
                                                                                                                           vivid
                                                                                                                           in
                                                                                                                           one's
                                                                                                                           mind
                                                                                                                           (idiom)
                                                                                                                        </div>
                                                                                                                     </div>
                                                                                                                  </button>
                                                                                                                  <button
                                                                                                                     type="button"
                                                                                                                     class="btn btn-light btn-block mb-2"
                                                                                                                     data-tag="3">
                                                                                                                     <div
                                                                                                                        class="row">
                                                                                                                        <div
                                                                                                                           class="col-12 english text-white">
                                                                                                                           unconscious
                                                                                                                           mind;
                                                                                                                           subconscious
                                                                                                                           mind;
                                                                                                                           subconsciousness
                                                                                                                        </div>
                                                                                                                     </div>
                                                                                                                  </button>
                                                                                                               </div>
                                                                                                            </div>
                                                                                                         </div>
                                                                                                         <div
                                                                                                            class="button-wrapper">
                                                                                                            <button
                                                                                                               type="button"
                                                                                                               id="btn_next_exercise"
                                                                                                               test_pahse="true"
                                                                                                               class="btn text-capitalize text-lg btn-secondary"
                                                                                                               data-bs-toggle="modal"
                                                                                                               data-bs-target="#exercise_modal">
                                                                                                               Next
                                                                                                               exercise<i
                                                                                                                  class="ml-2 fa fa-arrow-right"></i>
                                                                                                            </button>
                                                                                                         </div>
                                                                                 </div>
                                                                              </div>
                                                                           </div>
                                                                           <% } else if (key==="comments" ) { %>
                                                                              <div>
                                                                                 <div class="pb-4">
                                                                                    <button type="button"
                                                                                       class="btn float-right btn-default">
                                                                                       Leave Comment
                                                                                    </button>
                                                                                 </div>
                                                                                 <% for (var i=0; i < results.comments.comments.length; i++) { %>
                                                                                    <div>
                                                                                       <div
                                                                                          class="media-comment col-12 ">
                                                                                          <div>
                                                                                             <img alt="Profile picture"
                                                                                                class="avatar avatar-lg media-comment-avatar rounded-circle bg-light"
                                                                                                src="<%= results.comments.comments[i].avatarUrl || "https://www.chinesepod.com/dash/img/brand/symbol-black-center.svg" %>">
                                                                                          </div>
                                                                                          <div
                                                                                             class="media-body col-12">
                                                                                             <div
                                                                                                class="media-comment-text">
                                                                                                <h6 class="h5 mt-0">
                                                                                                   <%= results.comments.comments[i].username %>
                                                                                                </h6>
                                                                                                <small
                                                                                                   class="text-muted">
                                                                                                   <%= results.comments.comments[i].createdAt %>
                                                                                                </small>
                                                                                                <p
                                                                                                   class="text-sm lh-160 comment-item">
                                                                                                <p>
                                                                                                   <%- results.comments.comments[i].content %>
                                                                                                </p>
                                                                                                </p>
                                                                                                <div
                                                                                                   class="icon-actions">
                                                                                                   <a href=""
                                                                                                      class="like active">
                                                                                                      <i
                                                                                                         class="fas fa-reply"></i>
                                                                                                      <span
                                                                                                         class="text-muted">Reply</span>
                                                                                                   </a>
                                                                                                </div>
                                                                                             </div>
                                                                                          </div>
                                                                                       </div>
                                                                                    </div>
                                                                                    <% } %>
                                                                                       <hr>
                                                                                       <div>
                                                                                          <div
                                                                                             class="align-items-center">
                                                                                             <img alt="Profile Picture"
                                                                                                src="https://www.chinesepod.com/dash/img/brand/symbol-black-center.svg"
                                                                                                onerror="this.src='/home/img/brand/symbol-black-center.svg'"
                                                                                                class="d-none d-sm-block avatar avatar-lg rounded-circle mr-4">
                                                                                             <div class="media-body">
                                                                                                <div class="col-12"
                                                                                                   comment="[object Object]">
                                                                                                   <div class="menubar">
                                                                                                      <button
                                                                                                         class="menubar__button"><i
                                                                                                            class="fa fa-bold"></i></button>
                                                                                                      <button
                                                                                                         class="menubar__button"><i
                                                                                                            class="fa fa-italic"></i></button>
                                                                                                      <button
                                                                                                         class="menubar__button"><i
                                                                                                            class="fa fa-strikethrough"></i></button>
                                                                                                      <button
                                                                                                         class="menubar__button"><i
                                                                                                            class="fa fa-underline"></i></button>
                                                                                                      <button
                                                                                                         class="menubar__button is-active"><i
                                                                                                            class="fa fa-paragraph"></i></button>
                                                                                                      <button
                                                                                                         class="menubar__button">
                                                                                                         H1
                                                                                                      </button>
                                                                                                      <button
                                                                                                         class="menubar__button">
                                                                                                         H2
                                                                                                      </button>
                                                                                                      <button
                                                                                                         class="menubar__button">
                                                                                                         H3
                                                                                                      </button>
                                                                                                      <button
                                                                                                         class="menubar__button"><i
                                                                                                            class="fa fa-list-ul"></i></button>
                                                                                                      <button
                                                                                                         class="menubar__button"><i
                                                                                                            class="fa fa-list-ol"></i></button>
                                                                                                      <button
                                                                                                         class="menubar__button"><i
                                                                                                            class="fa fa-quote-right"></i></button>
                                                                                                      <button
                                                                                                         class="menubar__button"><i
                                                                                                            class="fa fa-image"></i></button>
                                                                                                      <button
                                                                                                         class="menubar__button"><i
                                                                                                            class="fa fa-highlighter"></i></button>
                                                                                                      <button
                                                                                                         class="menubar__button"><i
                                                                                                            class="fas fa-window-minimize"></i></button>
                                                                                                      <button
                                                                                                         class="menubar__button"><i
                                                                                                            class="fa fa-undo"></i></button>
                                                                                                      <button
                                                                                                         class="menubar__button"><i
                                                                                                            class="fa fa-redo"></i></button>
                                                                                                      <button
                                                                                                         class="menubar__button">pīnyīn</button>
                                                                                                   </div>
                                                                                                   <div> Replying to
                                                                                                      <span
                                                                                                         class="font-weight-bold">914364469</span>
                                                                                                   </div>
                                                                                                   <div
                                                                                                      class="text-editor">
                                                                                                      <input type="text"
                                                                                                         hidden="hidden">
                                                                                                      <div
                                                                                                         class="editor__content">
                                                                                                         <div
                                                                                                            class="ProseMirror"
                                                                                                            contenteditable="true"
                                                                                                            tabindex="0">
                                                                                                            <p class="is-empty is-editor-empty"
                                                                                                               data-empty-text="Leave a comment …">
                                                                                                               <br>
                                                                                                            </p>
                                                                                                         </div>
                                                                                                      </div>
                                                                                                   </div>
                                                                                                </div>
                                                                                             </div>
                                                                                          </div>
                                                                                          <div class="text-right mt-2">
                                                                                             <button type="button"
                                                                                                class="btn btn-secondary">Cancel</button>
                                                                                             <button type="button"
                                                                                                class="btn btn-default">Comment</button>
                                                                                          </div>
                                                                                       </div>
                                                                              </div>
                                                                              <% } %>



                                       </div>
                                    </div>
                        </div>
                        <%}%>
                  </div>
               </div>
            </div>
         </div>
         <footer class="footer px-4 mx-2">
            <div class="row align-items-center justify-content-lg-between">
               <div class="col-lg-4">
                  <div class="copyright text-center text-lg-left text-muted"> © 2023 ChinesePod LLC </div>
               </div>
               <div class="col-lg-8">
                  <ul class="nav nav-footer justify-content-center justify-content-lg-end">
                     <li class="nav-item">
                        <a href="/pricing" class="nav-link">Pricing</a>
                     </li>
                     <li class="nav-item">
                        <a href="/affiliates" class="nav-link">Become an Affiliate</a>
                     </li>
                     <li class="nav-item">
                        <a href="/corporate" class="nav-link">For Companies</a>
                     </li>
                     <li class="nav-item">
                        <a href="/schoolzone" class="nav-link">For Schools</a>
                     </li>
                     <li class="nav-item">
                        <a href="/start-learning-mandarin" class="nav-link">About Us</a>
                     </li>
                     <li class="nav-item">
                        <a href="/contact" class="nav-link">Contact Us</a>
                     </li>
                     <li class="nav-item">
                        <a href="/blog" class="nav-link">Blog</a>
                     </li>
                  </ul>
               </div>
            </div>
         </footer>
      </div>
   </div>
   <div class="bottom-player">
      <div style="">
         <button type="button" id="btn_bottom_play" class="btn float-right btn-icon-only btn-icon btn-fab btn-dark"><i
               class="text-white floating-player-icon fi flaticon-013-play"></i></button>
      </div>
      <div id="div_bottom_player" class="card bg-translucent-dark text-white border-0 audio-player-float mb-0 d-none">
         <div class=" d-flex align-items-center">
            <div class="col-12">
               <div class="mx-auto">
                  <div class="row text-center">
                     <div class="col-12">
                        <button type="button" id="btn_close_bottom_player"
                           class="btn float-right btn-icon-only bg-transparent border-0 shadow-none btn-default">
                           <i class="fa fa-times"></i>
                        </button>
                     </div>
                     <div class="col-12">
                        <div class="row">
                           <div class="col-4">
                              <button id="btn_rewind" type="button"
                                 class="btn bg-transparent border-0 shadow-none p-0 m-0 btn-default">
                                 <i class="fi flaticon-040-backward text-white emphasize-dark jump"></i>
                              </button>
                           </div>
                           <div class="col-4">
                              <button id="btn_bottom_playPause" type="button"
                                 class="btn bg-transparent border-0 shadow-none p-0 m-0 btn-default"><i
                                    class="text-white emphasize-dark play-button fi flaticon-013-play"></i></button>
                           </div>
                           <div class="col-4">
                              <button id="btn_forward" type="button"
                                 class="btn bg-transparent border-0 shadow-none p-0 m-0 btn-default">
                                 <i class="fi flaticon-032-forwards text-white emphasize-dark jump"></i>
                              </button>
                           </div>
                        </div>
                     </div>
                     <div class="col-12">
                        <div class="wrapper">
                           <div class="progress-white">
                              <div class="progress-label">
                                 <span>Binge watching - video</span>
                              </div>
                              <div class="progress-percentage">
                                 <span id="progress-percentage">0%</span>
                              </div>
                           </div>
                           <div class="progress" style="height: 8px;">
                              <div role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"
                                 id="bottomProgressbar" class="progress-bar bg-white" style="width: 0%;">
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
   <!--custom tooltip HTML starts here-->
   <div id="customTooltip" class="character-popover"
      style="display:none;width: 300px; transform-origin: center bottom; z-index: 2025; position: absolute; top: 0; left: 0;background: #fff;padding: 12px;"
      toolset="hidden">
      <div class="character mb-3">
         <div id="txtChinese"></div>
      </div>
      <p class="pinyin text-left text-break" id="txtPinyin"></p>
      <p class="english text-left text-break" id="txtEnglish"></p>
      <div class="text-right">
         <button type="button" onclick="onWordClick()" class="btn btn btn-icon-only btn-default">
            <i class=" fas fa-plus "></i>
         </button>
      </div>
      <div class="popper__arrow" style="left: 143px;"></div>
   </div>
   <!--custom tooltip HTML ends here-->
   <div class="modal fade2" id="exercise_modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
      aria-labelledby="exerciseModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
         <div class="modal-content p-3">
            <div class="swal2-header">
               <h2 class="swal2-title" id="swal2-title" style="display: flex;">Are you sure?</h2>
            </div>
            <div class="swal2-content">
               <div id="swal2-content" class="swal2-html-container" style="display: block;">You haven't finished this
                  exercise!</div>
            </div>
            <div class="swal2-actions">
               <button type="button" class="swal2-confirm swal2-styled" onclick="callNextExercise()"
                  data-bs-dismiss="modal">Skip</button>
               <button type="button" class="swal2-cancel swal2-styled" data-bs-dismiss="modal">Cancel</button>
            </div>
         </div>
      </div>
   </div>
   <!--notification alerts-->
   <div class="notifications" id="notifications"></div>
   <!--notification alerts-->
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
      crossorigin="anonymous"></script>
   <script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
   <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
   <script>
      //check if user is logged in or not if yes then get its token
      document.addEventListener("DOMContentLoaded", async () => {
         // let apiUrl = "https://www.chinesepod.com/api/v1/entrance/get-user";
         // replace 'v1' in url to 'v2/proxy' 
         let apiUrl = "https://www.chinesepod.com/api/v2/proxy/entrance/get-user";
         let apiUrlUserData = "https://www.chinesepod.com/api/v2/proxy/dashboard/get-info";

         // token 
         // www.chinesepod cookies | copy the cookies from www.chinesepod.com or you can fetch it dynamically

         // fetch API function
         let fetchApi = async (url, token) => {
            //console.log("inside function",this.browserCookies);
            let results = await fetch(apiUrl, {
               credentials: 'same-origin',
               headers: {
                  'Accept': 'application/json, text/plain, */*',
                  'Content-Type': 'application/json',
                  'Authorization': 'Bearer ' + (token ? token : ''),
                  'Cookies': this.browserCookies
               },
            })
               .then(resp => resp.json())
               .then(res => res)

            return results;
         }

         let getCookie = (name) => {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
         }

         // THIS WILL GET THE BROWSER COOKIE UNDER DOMAIN WHERE THIS HTML IS LOADED
         // if this html is loaded from a local server like apache the cookie should be under localhost
         // you can set the 'cpod.sid' under localhost to test

         this.browserCookies = getCookie('cpod.sid');

         // just a test to render token
         if (!this.browserCookies) this.browserCookies = "s%3Af6mkk2PLIqT2Iq3JHA4ucUAWQMbGqqzf.EDkEqFnGpH9dLSI%2FiO%2FjDgabFcPG6xxtkNEeaNzz%2Feg";

         this.browserCookies = 'cpod.sid=' + this.browserCookies;

         let entranceApiData = await fetchApi(apiUrl, this.token);

         console.log("is auth", entranceApiData);
         // CHECK IF TOKEN IS RETURNED
         if (entranceApiData && entranceApiData.token) {
            // logged in user
            // your function
            this.token = entranceApiData.token
            this.currentUserId = entranceApiData.userId
            console.log("found token, fetching users data");
            // TEST TO GET USERS DATA 
            let userData = await fetchApi(apiUrlUserData, this.token);
            console.log(userData);
         } else {
            console.log('not looged in');
            //redirect to login page 
         }

      });


      document.querySelector('.pr-3.sidenav-toggler.sidenav-toggler-light').addEventListener('click', function () {
         document.querySelector('body').classList.toggle('g-sidenav-show');
         document.querySelector('body').classList.toggle('g-sidenav-pinned');
      });

      if (window.innerWidth < 1200) {
         document.querySelector('body').classList.remove('g-sidenav-show');
         document.querySelector('body').classList.remove('g-sidenav-pinned');
      }
      document.querySelector('.sidenav-toggler').addEventListener('click', function () {
         //console.log('nav toggle clicked');
         document.querySelector('body').classList.toggle('g-sidenav-show');
         document.querySelector('body').classList.toggle('g-sidenav-pinned');
      });
      document.querySelector('.sidenav-toggler')

      const player = new Plyr('audio', {});
      const players = Plyr.setup('.js-player');

      //check video source from API and render that source in respective video player
      var videoSource = '<%- video?.src %>';
      console.log(videoSource);
      var videoURL;
      if (videoSource === "youtube") {
         videoURL = "6Y89TQ4Mkp8";
         var html = '<div id="playeryoutube" data-plyr-provider="youtube" data-plyr-embed-id="' + videoURL + '"></div>'
         document.getElementById("video_player_wrapper").innerHTML = html;
         const player = new Plyr('#playeryoutube', {});
         window.player = player;
         console.log('Youtube is video source');
      } else if (videoSource === "vimeo") {
         videoURL = "644036051";
         var html = '<div id="playervimeo" data-plyr-provider="vimeo" data-plyr-embed-id="' + videoURL + '"></div>';
         document.getElementById("video_player_wrapper").innerHTML = html;
         const player = new Plyr('#playervimeo', {});
         window.player = player;
         console.log('vimeo is video source');
      } else if (videoSource === "dailymotion") {
         videoURL = "x8hq0dw";
         var html = '<div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;"> <iframe style="width:100%;height:100%;position:absolute;left:0px;top:0px;overflow:hidden" frameborder="0" type="text/html" src="https://www.dailymotion.com/embed/video/' + videoURL + '" width="100%" height="100%" allowfullscreen="" title="Dailymotion Video Player"></iframe></div>';
         document.getElementById("video_player_wrapper").innerHTML = html;
         console.log('Dailymotion is video source');
      } else if (videoSource === "aws") {
         console.log('AWS is video source');
      }
      //vocabulary player control
      document.addEventListener('DOMContentLoaded', () => {
         const vocabplayer = new Plyr('#vocabplyrlist', {
            controls: ['play', 'progress', 'settings'],
         });
         window.vocabplayer = vocabplayer;
         // Bind event listener
         function on(selector, type, callback) {
            document.querySelector(selector).addEventListener(type, callback, false);
         }
      });

      document.addEventListener('DOMContentLoaded', function () {
         var playerSrcs = document.querySelectorAll('.player-src');
         playerSrcs.forEach(function (playerSrc) {
            playerSrc.addEventListener('click', function () {
               var src = playerSrc.dataset.src;
               var type = 'audio/' + playerSrc.dataset.type;
               vocabplayer.source = {
                  type: 'audio',
                  title: 'Example title',
                  sources: [
                     {
                        src: src,
                        type: type,
                     }
                  ]
               };
               document.getElementById('vocab_aduio_player').classList.remove('d-none');
               vocabplayer.play();
            });
         });
      });
      //vocabulary player control

      var sprControls = document.getElementById("sprControls")
      sprControls.onmouseover = function () {
         document.getElementById("sprPopper").style.display = 'block';
      }
      sprControls.onmouseout = function () {
         document.getElementById("sprPopper").style.display = 'none';
      }

      //initilize tooltip
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))

      //tabs data handlders
      function toggleDisplayAssistance(x, y) {
         if (document.getElementById(y).innerHTML === '<i class="fas fa-eye"></i>') {
            document.getElementById(y).innerHTML = '<i class="fas fa-times"></i>';
            document.getElementById(x).style.display = 'block';
         } else if (document.getElementById(y).innerHTML === '<i class="fas fa-times"></i>') {
            document.getElementById(y).innerHTML = '<i class="fas fa-eye"></i>';
            document.getElementById(x).style.display = 'none';
         }
      }
      function toggleTranslatePlay(x) {
         if (x.innerHTML === '<i class="fas fa-volume-up"></i>') {
            x.innerHTML = '<i class="fas fa-times"></i>';
            document.getElementById("play_wrapper_" + x.getAttribute('play-info')).classList.remove("d-none");
         } else if (x.innerHTML === '<i class="fas fa-times"></i>') {
            x.innerHTML = '<i class="fas fa-volume-up"></i>';
         }
      }
      //tabs data handlders
      //Custom tooltip handlders
      function tip(w, x, y, z) {
         document.getElementById("customTooltip").style.display = "grid";
         document.getElementById("txtChinese").innerHTML = z;
         document.getElementById("txtPinyin").innerHTML = y;
         document.getElementById("txtEnglish").innerHTML = x;
         document.getElementById("customTooltip").setAttribute("toolset", "visible")

      }

      function getOffset(el) {
         const rect = el.getBoundingClientRect();
         return {
            left: rect.left + window.scrollX,
            top: rect.top + window.scrollY,
            width: rect.width,
            height: rect.height
         };
      }
      function onWordClick() {
         //console.log('onWordClick called');
      }

      //hide tooltip when clciked somewhere outside of a tooltip area after tooltip is visible
      window.addEventListener('click', function (e) {
         //console.log(e);
         if (document.getElementById('customTooltip').contains(e.target)) {
         } else if (e.srcElement.classList.value === 'transcript align-middle el- characters' || e.srcElement.classList.value === 'transcript align-middle') {
            //console.log(document.getElementById("customTooltip").getBoundingClientRect().height);
            document.getElementById("customTooltip").style.left = (e.pageX - document.getElementById("customTooltip").getBoundingClientRect().width / 2) + 'px';
            if (e.clientY > document.getElementById("customTooltip").getBoundingClientRect().height) {
               document.getElementById("customTooltip").style.top = (e.pageY - document.getElementById("customTooltip").getBoundingClientRect().height - 40) + 'px';
            } else if (e.clientY < document.getElementById("customTooltip").getBoundingClientRect().height) {
               document.getElementById("customTooltip").style.top = (e.pageY + 20) + 'px';
            }
         } else {
            document.getElementById("customTooltip").style.display = "none";
            document.getElementById("customTooltip").style.left = 0;
            document.getElementById("customTooltip").style.top = 0;
            document.getElementById("txtChinese").innerHTML = "";
            document.getElementById("txtPinyin").innerHTML = "";
            document.getElementById("txtEnglish").innerHTML = "";
            document.getElementById("customTooltip").setAttribute('toolset', 'hidden')
         }

      });
      //Custom tooltip handlders end--

      // AWS player script starts here
      (function () {
         if (document.getElementById("videoplyr-s3"))
            fetch("https://www.chinesepod.com/api/v2/custom/lessons/get-lesson-url/BV0002",
               {
                  method: "GET",
                  headers: {
                     'Content-Type': 'application/json',
                  }
               }).then(response => response.json())
               .then(data => {
                  //console.log(data);
                  let videoplyr;
                  const video = document.querySelector('#videoplyr-s3');
                  hlsNativeSupport = video && video.canPlayType('application/vnd.apple.mpegURL');

                  const defaultOptions = {};

                  const hls = new Hls();
                  hls.loadSource(data.src);

                  hls.on(Hls.Events.MANIFEST_PARSED, (event, data) => {
                     // Transform available levels into an array of integers (height values).
                     const availableQualities = hls.levels.map(l => l.height);

                     // Add new qualities to option
                     defaultOptions.quality = {
                        default: availableQualities[3],
                        options: [...availableQualities],
                        // this ensures Plyr to use Hls to update quality level
                        forced: true,
                        onChange: e => updateQuality(e)
                     };

                     videoplyr = new Plyr('#videoplyr-s3', defaultOptions);
                     videoplyr.on('ready', (event) => {
                        const instance = event.detail.plyr;
                        console.log(instance);
                     });
                     videoplyr.on('ready', () => {
                        //console.log('this called');
                     });
                     videoplyr.on('timeupdate', event => {
                        document.getElementById('bottomProgressbar').style.width = ~~((videoplyr.currentTime / videoplyr.duration) * 100) + '%';;
                        document.getElementById('progress-percentage').innerHTML = ~~((videoplyr.currentTime / videoplyr.duration) * 100) + '%';;
                        if (window.hls.currentLevel > -1) {
                           this.videoplyr.quality = availableQualities[window.hls.currentLevel];
                        }
                     });

                     videoplyr.on('waiting', event => {
                        const startBuffer = videoplyr.buffered;
                        setTimeout(() => {
                           //console.log('Player Buffering');
                           //console.log({
                           //startBuffer,
                           //currentBuffer: videoplyr.buffered
                           //});
                           if (startBuffer === videoplyr.buffered) {
                              setAutomaticQuality();
                           }
                        }, 20000);
                     });
                     videoplyr.on('play', (event) => {
                        if (document.getElementById('btn_bottom_play').innerHTML === '<i class="text-white floating-player-icon fi flaticon-013-play"></i>') {
                           document.getElementById('btn_bottom_play').innerHTML = '<i class="text-white floating-player-icon fi flaticon-021-pause"></i>';
                        }
                        if (document.getElementById('btn_bottom_playPause').innerHTML === '<i class="text-white emphasize-dark play-button fi flaticon-013-play"></i>') {
                           document.getElementById('btn_bottom_playPause').innerHTML = '<i class="text-white emphasize-dark play-button fi flaticon-021-pause"></i>';
                        }
                     });
                     videoplyr.on('pause', (event) => {
                        if (document.getElementById('btn_bottom_play').innerHTML === '<i class="text-white floating-player-icon fi flaticon-021-pause"></i>') {
                           document.getElementById('btn_bottom_play').innerHTML = '<i class="text-white floating-player-icon fi flaticon-013-play"></i>';
                        }
                        if (document.getElementById('btn_bottom_playPause').innerHTML === '<i class="text-white emphasize-dark play-button fi flaticon-021-pause"></i>') {
                           document.getElementById('btn_bottom_playPause').innerHTML = '<i class="text-white emphasize-dark play-button fi flaticon-013-play"></i>';
                        }
                     });

                     videoplyr.on('ended', (event) => {
                        console.log('video ended');
                        callOverlay();
                     });


                     document.getElementById('btnRepeatVideo').addEventListener('click', function () {
                        document.querySelector('.card-img-overlay').classList.add('d-none');
                        document.querySelector('.card-img-overlay').classList.remove('d-flex');
                        videoplyr.restart();
                        videoplyr.play();
                        console.log('Restart Called');
                     });

                     document.getElementById('btn_bottom_playPause').addEventListener('click', function () {
                        if (document.getElementById('btn_bottom_playPause').innerHTML === '<i class="text-white emphasize-dark play-button fi flaticon-013-play"></i>') {
                           videoplyr.play();
                           document.getElementById('btn_bottom_playPause').innerHTML = '<i class="text-white emphasize-dark play-button fi flaticon-021-pause"></i>';
                        } else if (document.getElementById('btn_bottom_playPause').innerHTML === '<i class="text-white emphasize-dark play-button fi flaticon-021-pause"></i>') {
                           videoplyr.pause()
                           document.getElementById('btn_bottom_playPause').innerHTML = '<i class="text-white emphasize-dark play-button fi flaticon-013-play"></i>';
                        }
                     });

                     const fw = document.getElementById('btn_forward');
                     const rw = document.getElementById('btn_rewind');
                     fw.addEventListener('click', () => videoplyr.forward(6));
                     rw.addEventListener('click', () => videoplyr.rewind(6));

                  });
                  hls.attachMedia(video);
                  window.hls = hls;

                  const updateQuality = newQuality => {
                     window.hls.levels.forEach((level, levelIndex) => {
                        if (level.height === newQuality) {
                           if (window.hls.currentLevel !== levelIndex) {
                              //console.log('Found quality match with ' + newQuality);
                              window.hls.currentLevel = levelIndex;
                           }
                        }
                     });
                  };

                  function setAutomaticQuality() {
                     //console.log('Current level: ' + window.hls.currentLevel);
                     window.hls.currentLevel = -1;
                     // console.log('New level: ' + window.hls.currentLevel);
                  }


               })
               .catch((err) => {
                  console.log(err);
               })
      })();

      //overlay on video player when vidoe ends
      function callOverlay() {
         document.querySelector('.card-img-overlay').classList.remove('d-none');
         document.querySelector('.card-img-overlay').classList.add('d-flex');
      }
      //overlay on video player when vidoe ends

      // AWS player script starts here
      //bottom player
      document.getElementById("adminsidebar").style.height = window.innerHeight + "px";
      document.getElementById("btn_bottom_play").onclick = () => {
         document.getElementById("btn_bottom_play").classList.add("d-none");
         document.getElementById("div_bottom_player").classList.remove("d-none");
      }
      document.getElementById("btn_close_bottom_player").onclick = () => {
         document.getElementById("btn_bottom_play").classList.remove("d-none");
         document.getElementById("div_bottom_player").classList.add("d-none");
      }


      //bottom player
      //Multistep excercise
      function callNextExercise() {
         if (document.getElementById("btn_next_exercise").getAttribute("test_pahse") === 'true') {
            const current_exercise = document.querySelector('[exercise_active="true"]');
            console.log(current_exercise.id.split('_')[0] + '_' + (Number(current_exercise.id.split('_')[1]) + 1).toString().padStart(3, "0"))
            document.getElementById(current_exercise.id).classList.add("d-none");
            document.getElementById(current_exercise.id).setAttribute("exercise_active", "flase");
            if (document.querySelectorAll("[exercise_active]").length < Number(current_exercise.id.split('_')[1]) + 1) {
               document.getElementById("btn_next_exercise").setAttribute("test_pahse", "false")
               document.getElementById("btn_next_exercise").innerHTML = "Try Again";
               document.getElementById("btn_next_exercise").removeAttribute("data-bs-toggle");
               document.getElementById("btn_next_exercise").removeAttribute("data-bs-target");
               callNextExercise();
               console.log('Excercise Ended');
               console.log('Call result div');
            } else {
               document.getElementById(current_exercise.id.split('_')[0] + '_' + (Number(current_exercise.id.split('_')[1]) + 1).toString().padStart(3, "0")).classList.remove("d-none");
               document.getElementById(current_exercise.id.split('_')[0] + '_' + (Number(current_exercise.id.split('_')[1]) + 1).toString().padStart(3, "0")).setAttribute("exercise_active", "true");
            }
         } else {
            console.log('restart excercise');
         }
      }
      //Multistep excercise

      //add to Vocabulary
      function addToVocabulary(x, y) {
         console.log('addToVocabulary called')
         if (x.getAttribute('vocab-added') === 'false') {
            console.log('addToVocabulary called false')
            x.innerHTML = '<i class="m-0 fas fa-spinner fa-spin"></i>';
            x.classList.add('text-danger');
            var data = {};
            let sybmitUrl = window.location.href;
            let submitData = { method: "POST", body: JSON.stringify(data) };
            console.log("Getting ready to post:")
            console.log(submitData);
            submitData.headers = { 'Content-Type': 'application/json' };
            fetch('https://jsonplaceholder.typicode.com/posts', submitData)
               .then(response => response.json())
               .then(data => {
                  console.log("Request complete! response:", data);
                  x.innerHTML = '<i class="fas fa-plus"></i>';
                  x.setAttribute('vocab-added', 'true');
                  callNotification(y, 'Added');
               });
         } else if (x.getAttribute('vocab-added') === 'true') {
            console.log('addToVocabulary called true')
            x.innerHTML = '<i class="m-0 fas fa-spinner fa-spin"></i>';
            x.classList.add('text-danger');
            var data = {};
            let sybmitUrl = window.location.href;
            let submitData = { method: "POST", body: JSON.stringify(data) };
            console.log("Getting ready to post:")
            console.log(submitData);
            submitData.headers = { 'Content-Type': 'application/json' };
            fetch('https://jsonplaceholder.typicode.com/posts', submitData)
               .then(response => response.json())
               .then(data => {
                  console.log("Request complete! response:", data);
                  x.innerHTML = '<i class="fas fa-plus"></i>';
                  x.setAttribute('vocab-added', 'false');
                  x.classList.remove('text-danger');
                  callNotification(y, 'Removed')
               });
         }
      }

      function callNotification(x, y) {
         var vocabString = '';
         if (y === 'Added') {
            vocabString = y + ' ' + x + ' to your vocabulary.';
         } else if (y === 'Removed') {
            vocabString = y + ' ' + x + ' from your vocabulary.';
         } else if (y === 'Copied') {
            vocabString = y + ' ' + x + ' to clipboard.'
         }
         console.log(vocabString);
         var html = '';
         html += '<div role="alert" class="alert alert-notify alert-dismissible top right alert-success v-leave slideYOut slide-move" style="top: 20px; animation-duration: 200ms; animation-delay: 0ms; animation-fill-mode: both; animation-timing-function: cubic-bezier(0.25, 0.8, 0.5, 1);">';
         html += '<span class="alert-text"><span>' + vocabString + '</span></span>';
         html += '<button type="button" onclick="closeAlert()" class="close"><span aria-hidden="true">×</span></button>';
         html += '</div>';
         document.getElementById('notifications').innerHTML = html;
         setTimeout(function () {
            document.getElementById('notifications').innerHTML = '';
            console.log('setTimeout called')
         }, 5000);
      }
      function closeAlert() {
         document.getElementById('notifications').innerHTML = '';
      }
      //add to Vocabulary

      //functions to handle user response on lesson page
      document.getElementById('btn_save_lesson').addEventListener('click', function () {
         if (document.getElementById('btn_save_lesson').getAttribute('data-saved') === 'false') {
            document.getElementById('btn_save_lesson').classList.add('text-danger');
            document.getElementById('btn_save_lesson').innerHTML = '<i class="m-0 fas fa-spinner fa-spin"></i><span class="d-none d-lg-block"> Saving</span>';
            console.log('btn_save_lesson clicked');
            var data = {};
            let sybmitUrl = window.location.href;
            let submitData = { method: "POST", body: JSON.stringify(data) };
            console.log("Getting ready to post:")
            console.log(submitData);
            submitData.headers = { 'Content-Type': 'application/json' };
            fetch('https://jsonplaceholder.typicode.com/posts', submitData)
               .then(response => response.json())
               .then(data => {
                  console.log("Request complete! response:", data);
                  document.getElementById('btn_save_lesson').innerHTML = '<i class="m-0 fas fa-bookmark"></i><span class="d-none d-lg-block"> Saved</span>';
                  document.getElementById('btn_save_lesson').setAttribute('data-saved', 'true');
               });
         } else if (document.getElementById('btn_save_lesson').getAttribute('data-saved') === 'true') {
            document.getElementById('btn_save_lesson').classList.remove('text-danger');
            document.getElementById('btn_save_lesson').innerHTML = '<i class="m-0 fas fa-spinner fa-spin"></i><span class="d-none d-lg-block"> Removing</span>';
            console.log('btn_save_lesson clicked');
            var data = {};
            let sybmitUrl = window.location.href;
            let submitData = { method: "POST", body: JSON.stringify(data) };
            console.log("Getting ready to post:")
            console.log(submitData);
            submitData.headers = { 'Content-Type': 'application/json' };
            fetch('https://jsonplaceholder.typicode.com/posts', submitData)
               .then(response => response.json())
               .then(data => {
                  console.log("Request complete! response:", data);
                  document.getElementById('btn_save_lesson').innerHTML = '<i class="m-0 far fa-bookmark"></i><span class="d-none d-lg-block"> Save</span>';
                  document.getElementById('btn_save_lesson').setAttribute('data-saved', 'false');
               });
         }
      });
      document.getElementById('btn_mark_complete').addEventListener('click', function () {
         if (document.getElementById('btn_mark_complete').getAttribute('data-mark-complete') === 'false') {
            document.getElementById('btn_mark_complete').classList.add('text-danger');
            document.getElementById('btn_mark_complete').innerHTML = '<i class="m-0 fas fa-spinner fa-spin"></i><span class="d-none d-lg-block"> Complete</span>';
            console.log('btn_mark_complete clicked');
            var data = {};
            let sybmitUrl = window.location.href;
            let submitData = { method: "POST", body: JSON.stringify(data) };
            console.log("Getting ready to post:")
            console.log(submitData);
            submitData.headers = { 'Content-Type': 'application/json' };
            fetch('https://jsonplaceholder.typicode.com/posts', submitData)
               .then(response => response.json())
               .then(data => {
                  console.log("Request complete! response:", data);
                  document.getElementById('btn_mark_complete').innerHTML = '<i class="m-0 fas fa-check-circle"></i><span class="d-none d-lg-block"> Completed</span>';
                  document.getElementById('btn_mark_complete').setAttribute('data-mark-complete', 'true');
               });
         } else if (document.getElementById('btn_mark_complete').getAttribute('data-mark-complete') === 'true') {
            document.getElementById('btn_mark_complete').classList.remove('text-danger');
            document.getElementById('btn_mark_complete').innerHTML = '<i class="m-0 fas fa-spinner fa-spin"></i><span class="d-none d-lg-block"> Complete</span>';
            console.log('btn_mark_complete clicked');
            var data = {};
            let sybmitUrl = window.location.href;
            let submitData = { method: "POST", body: JSON.stringify(data) };
            console.log("Getting ready to post:")
            console.log(submitData);
            submitData.headers = { 'Content-Type': 'application/json' };
            fetch('https://jsonplaceholder.typicode.com/posts', submitData)
               .then(response => response.json())
               .then(data => {
                  console.log("Request complete! response:", data);
                  document.getElementById('btn_mark_complete').innerHTML = '<i class="m-0 far fa-check-circle"></i><span class="d-none d-lg-block"> Complete</span>';
                  document.getElementById('btn_mark_complete').setAttribute('data-mark-complete', 'false');
               });
         }
      });
      //vocabulary printing
      function vocabcreatePDF() {
         var vocTable = document.getElementById('vocabTable').innerHTML;
         // add all the css and styling for the table 
         var style = "<style>";
         style = style + "table {width: 100%;font: 17px Calibri;text-align: center;}";
         style = style + "table th {border-bottom: solid 2px #ccc;border-top: solid 2px #ccc; border-collapse: collapse;";
         style = style + "table td {border-bottom: solid 1px #ccc; border-collapse: collapse;";
         style = style + "padding: 2px 3px;text-align: center;}";
         style = style + "</style>";
         style = style + "<style type='text/css' media='print'>@page{size: auto;margin: 0mm;</style>";

         // here we creat our window object
         var win = window.open('', '', 'height=700,width=700');

         win.document.write('<html><head>');
         win.document.write(style);
         win.document.write('</head>');
         win.document.write('<body>');
         win.document.write(vocTable);
         win.document.write('</body></html>');

         win.document.close();

         win.print();
      }
      //vocabulary printing
      //dialogue printing
      function dialoguecreatePDF() {
         var vocTable = document.getElementById('lessonDialogue').innerHTML;
         // add all the css and styling for the table 
         var style = "<style type='text/css' media='print'>@page{size: auto;margin: 0mm;</style>";

         // here we creat our window object
         var win = window.open('', '', 'height=700,width=700');

         win.document.write('<html><head>');
         win.document.write(style);
         win.document.write('</head>');
         win.document.write('<body>');
         win.document.write(vocTable);
         win.document.write('</body></html>');

         win.document.close();

         win.print();
      }
      //dialogue printing
      //Copy vocabulary on Clipboard
      function copyVocabOnCB(x, y, z) {
         navigator.clipboard.writeText(x + ' - ' + y + ' - ' + z);
         callNotification(x, 'Copied')
      }
      //Copy vocabulary on Clipboard
      //functions to handle user response on lesson page
      //vocabulary character animation
      const characterList = document.querySelectorAll(".cp-char.characters");
      var characterListWord = []
      var chars = {};
      var delayBetweenAnimations = 1000;
      for (let i = 0; i < characterList.length; i++) {
         var string = /(?<=([^-]*-){2}).*/.exec(characterList[i].id)[0]
         if (characterList[i].id.split("-")[1] == 0) {
            characterListWord[`${characterList[i].id.split("-")[0]}`] = [];
         }
         characterListWord[`${characterList[i].id.split("-")[0]}`].push(HanziWriter.create(characterList[i].id, string, {
            width: 35,
            height: 35,
            padding: 0,
            showCharacter: true
         }))

         var j;
         characterList[i].addEventListener('click', function (e) {
            e.preventDefault();
            j = 0;
            for (var f = 0; characterListWord[characterList[i].id.split("-")[0]].length > f; f++) {
               characterListWord[characterList[i].id.split("-")[0]][f].hideCharacter();
            }
            function play(p) {
               characterListWord[characterList[i].id.split("-")[0]][p].animateCharacter({
                  onComplete: function () {
                     setTimeout(function () {
                        play(p + 1)
                     }, delayBetweenAnimations);
                  }
               });
            }
            play(j)
         })
      }
         //vocabulary character animation

   </script>
</body>

</html>